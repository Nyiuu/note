### 1. VARMA 模型概述

VARMA (Vector Autoregressive Moving Average) 是处理多变量时间序列的统计模型，结合了自回归 (AR) 和移动平均 (MA) 部分。
数学表达式为：
$$Y_t = c + \sum_{i=1}^p \Phi_i Y_{t-i} + \sum_{j=1}^q \Theta_j \epsilon_{t-j} + \epsilon_t$$
### 2.什么是时间序列

**时间序列**就是按时间顺序排列的数据，比如每天的温度、每月的降水量。  
我们的目标是：通过历史数据（比如过去 10 天的温度），预测未来的温度（比如明天、后天的温度）。  
**核心思路**：找到数据随时间变化的规律，用数学公式 “拟合” 这些规律，再用公式算未来的值。
### 3.从简单模型到 VARMA 模型

#### 1. 单变量自回归模型（AR 模型）

假设今天的温度只和过去几天的温度有关，比如： $\text{今天温度} = a_1 \times \text{昨天温度} + a_2 \times \text{前天温度} + \text{误差}$ 这就是**AR 模型**（自回归模型），其中$a_1, a_2$是系数，“误差” 是无法用历史数据解释的随机波动。 **数学本质**：用线性组合拟合历史数据，系数通过最小二乘法求解（让预测误差的平方和最小）。

#### 2. 单变量移动平均模型（MA 模型）

假设今天的温度和过去几天的 “误差” 有关，比如： $\text{今天温度} = \text{平均温度} + b_1 \times \text{昨天误差} + b_2 \times \text{前天误差}$ 这就是**MA 模型**（移动平均模型），其中$b_1, b_2$是系数，用来描述误差的影响。

#### 3. 多变量模型：VARMA 模型

如果我们同时有多个变量（比如温度、湿度、风速），需要用**多变量模型**：
数学表达式为：
$$Y_t = c + \sum_{i=1}^p \Phi_i Y_{t-i} + \sum_{j=1}^q \Theta_j \epsilon_{t-j} + \epsilon_t$$
  
- $T_{t}$是 k 维向量，表示 t 时刻的观测值
- p是 AR 部分阶数，q是 MA 部分阶数
- $\Phi_{i}$是 AR 系数矩阵，$\theta_{j}$是 MA 系数矩阵
- $\epsilon_t$是 k 维白噪声向量
  

### 4. 训练过程数学原理

#### 1 AR 系数估计
代码首先估计 AR 部分系数，这与 VAR 模型的估计方法相同。数学原理是最小二乘法：
1. 构建设计矩阵X和目标矩阵Y：
    - X的每一行包含前p个时间点的所有变量值
    - Y包含当前时间点的所有变量值
2. 求解线性方程组： $\hat{\Phi} = (X^T X)^{-1} X^T Y$

这部分对应代码中的：
```cpp
AR_coef = (X.transpose() * X).ldlt().solve(X.transpose() * Y);
```

#### 2 MA 系数估计

MA 系数估计使用简化方法，对每维单独进行线性回归：
1. 构建残差矩阵Z和目标残差矩阵E：
    - Z的每一行包含前q个时间点的残差值
    - E包含当前时间点的残差值
2. 求解线性方程组： $\hat{\Theta} = (Z^T Z)^{-1} Z^T E$
这部分对应代码中的：
```cpp
MA_coef = (Z.transpose() * Z).ldlt().solve(Z.transpose() * E);
```


- 模型训练时自动处理滞后阶数（`p=2`, `q=1`），通过最小二乘法拟合自回归（AR）和移动平均（MA）系数。
