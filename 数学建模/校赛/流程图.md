\documentclass{article}
\usepackage[UTF8]{ctex} % For Chinese characters
\usepackage{tikz}
\usetikzlibrary{shapes.geometric, arrows.meta, positioning}
\usepackage[a3paper, margin=1in, landscape]{geometry} % Use a3 paper for landscape flowchart

\begin{document}
\begin{figure}[h!]
\centering
\caption{C++代码逻辑流程图}
\begin{tikzpicture}[
    node distance=0.8cm and 1.5cm, % vertical and horizontal node distance (increased horizontal)
    block/.style={
        rectangle,
        draw,
        fill=gray!15, % Slightly lighter gray
        text width=3.8cm, % Adjusted for Chinese text and consistency
        text centered,
        minimum height=1.8cm, % Adjusted height
        font=\small % Using small font
    },
    arrow/.style={-Stealth, thick} % Stealth arrow tip
]

% Define the main problem blocks (top row)
\node[block] (P1) {问题一：数据处理与初始化};
\node[block, right=of P1] (P2) {问题二：历史趋势分析};
\node[block, right=of P2] (P3) {问题三：VARMA模型构建};
\node[block, right=of P3] (P4) {问题四：模型预测与评估};
\node[block, right=of P4] (P5) {问题五：关键阈值识别};

% Arrows between main problem blocks
\draw[arrow] (P1) -- (P2);
\draw[arrow] (P2) -- (P3);
\draw[arrow] (P3) -- (P4);
\draw[arrow] (P4) -- (P5);

% Chain for Problem 1: 数据处理与初始化
\node[block, below=1.2cm of P1] (S1) {CSV数据解析与地理区域划分}; % Middle block
\node[block, below=of S1] (M1) {文件流读取，字符串处理与校验，基于经纬度网格化数据}; % Bottom block
\draw[arrow] (P1) -- (S1);
\draw[arrow] (S1) -- (M1);

% Chain for Problem 2: 历史趋势分析
\node[block, below=1.2cm of P2] (S2) {全球年均温序列构建};
\node[block, below=of S2] (M2) {数据聚合，计算各年度平均温度，转换为时间序列格式};
\draw[arrow] (P2) -- (S2);
\draw[arrow] (S2) -- (M2);

% Chain for Problem 3: VARMA模型构建
\node[block, below=1.2cm of P3] (S3) {VARMA(2,1)模型参数估计};
\node[block, below=of S3] (M3) {AR部分：最小二乘回归；MA部分：基于AR残差的最小二乘回归};
\draw[arrow] (P3) -- (S3);
\draw[arrow] (S3) -- (M3);

% Chain for Problem 4: 模型预测与评估
\node[block, below=1.2cm of P4] (S4) {历史数据拟合与未来温度预测};
\node[block, below=of S4] (M4) {历史拟合：迭代单步预测；未来展望：迭代多步预测};
\draw[arrow] (P4) -- (S4);
\draw[arrow] (S4) -- (M4);

% Chain for Problem 5: 关键阈值识别
\node[block, below=1.2cm of P5] (S5) {20°C升温阈值年份搜索};
\node[block, below=of S5] (M5) {遍历未来温度预测序列，检索并确定首个达标年份};
\draw[arrow] (P5) -- (S5);
\draw[arrow] (S5) -- (M5);

\end{tikzpicture}
\end{figure}
\end{document}